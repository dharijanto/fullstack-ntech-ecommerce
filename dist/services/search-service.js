"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const SphinxClient=require("sphinxapi"),local_shop_service_1=require("../app/local-shop-services/local-shop-service"),product_service_1=require("./product-service");class SearchService{constructor(){this.sphinxClient=new SphinxClient}initialize(){return this.sphinxClient.SetServer("localhost",9312),new Promise((e,t)=>{this.sphinxClient.Status((r,s)=>{r?t(r):e()})})}searchInStockProducts(e){return new Promise((t,r)=>{this.sphinxClient.Query(e,"inStockProducts",(e,s)=>{try{if(e)throw e;{const e=s.matches.map(e=>e.id);local_shop_service_1.default.getInStockProducts({productId:e}).then(e=>{t(e)}).catch(e=>{throw e})}}catch(e){r(e)}})})}searchPOProducts(e){return new Promise((t,r)=>{this.sphinxClient.Query(e,"poProducts",(e,s)=>{try{if(e)throw e;{const e=s.matches.map(e=>e.id);local_shop_service_1.default.getPOProducts({productId:e}).then(e=>{t(e)}).catch(e=>{throw e})}}catch(e){r(e)}})})}searchSubCategories(e){return new Promise((t,r)=>{this.sphinxClient.Query(e,"subCategories",(e,s)=>{try{if(e)throw e;{const e=s.matches.map(e=>e.id);product_service_1.default.getSubCategories({id:e}).then(e=>{t(e)}).catch(e=>{throw e})}}catch(e){r(e)}})})}}exports.default=new SearchService;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXJ2aWNlcy9zZWFyY2gtc2VydmljZS50cyJdLCJuYW1lcyI6WyJTcGhpbnhDbGllbnQiLCJyZXF1aXJlIiwibG9jYWxfc2hvcF9zZXJ2aWNlXzEiLCJwcm9kdWN0X3NlcnZpY2VfMSIsIlNlYXJjaFNlcnZpY2UiLCJbb2JqZWN0IE9iamVjdF0iLCJ0aGlzIiwic3BoaW54Q2xpZW50IiwiU2V0U2VydmVyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJTdGF0dXMiLCJlcnIiLCJyZXN1bHQiLCJxdWVyeSIsIlF1ZXJ5IiwiaWRzIiwibWF0Y2hlcyIsIm1hcCIsIm1hdGNoIiwiaWQiLCJkZWZhdWx0IiwiZ2V0SW5TdG9ja1Byb2R1Y3RzIiwicHJvZHVjdElkIiwidGhlbiIsInJlc3AiLCJjYXRjaCIsImdldFBPUHJvZHVjdHMiLCJnZXRTdWJDYXRlZ29yaWVzIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Im9FQUFBLE1BQUFBLGFBQUFDLFFBQUEsYUFDQUMscUJBQUFELFFBQUEsaURBQ0FFLGtCQUFBRixRQUFBLDJCQUtBRyxjQUVFQyxjQUNFQyxLQUFLQyxhQUFlLElBQUlQLGFBRzFCSyxhQUVFLE9BREFDLEtBQUtDLGFBQWFDLFVBQVUsWUFBYSxNQUNsQyxJQUFJQyxRQUFRLENBQUNDLEVBQVNDLEtBQzNCTCxLQUFLQyxhQUFhSyxPQUFPLENBQUNDLEVBQUtDLEtBQ3pCRCxFQUNGRixFQUFPRSxHQUVQSCxRQU9STCxzQkFBdUJVLEdBQ3JCLE9BQU8sSUFBSU4sUUFBUSxDQUFDQyxFQUFTQyxLQUUzQkwsS0FBS0MsYUFBYVMsTUFBTUQsRUFBTyxrQkFBbUIsQ0FBQ0YsRUFBS0MsS0FDdEQsSUFDRSxHQUFJRCxFQUNGLE1BQU1BLEVBQ0QsQ0FDTCxNQUFNSSxFQUFNSCxFQUFPSSxRQUFRQyxJQUFJQyxHQUFTQSxFQUFNQyxJQUM5Q25CLHFCQUFBb0IsUUFBaUJDLG9CQUFxQkMsVUFBV1AsSUFBT1EsS0FBS0MsSUFDM0RoQixFQUFRZ0IsS0FDUEMsTUFBTWQsSUFDUCxNQUFNQSxLQUdWLE1BQU9BLEdBQ1BGLEVBQU9FLFFBTWZSLGlCQUFrQlUsR0FDaEIsT0FBTyxJQUFJTixRQUFRLENBQUNDLEVBQVNDLEtBRTNCTCxLQUFLQyxhQUFhUyxNQUFNRCxFQUFPLGFBQWMsQ0FBQ0YsRUFBS0MsS0FDakQsSUFDRSxHQUFJRCxFQUNGLE1BQU1BLEVBQ0QsQ0FDTCxNQUFNSSxFQUFNSCxFQUFPSSxRQUFRQyxJQUFJQyxHQUFTQSxFQUFNQyxJQUM5Q25CLHFCQUFBb0IsUUFBaUJNLGVBQWdCSixVQUFXUCxJQUFPUSxLQUFLQyxJQUN0RGhCLEVBQVFnQixLQUNQQyxNQUFNZCxJQUNQLE1BQU1BLEtBR1YsTUFBT0EsR0FDUEYsRUFBT0UsUUFNZlIsb0JBQXFCVSxHQUNuQixPQUFPLElBQUlOLFFBQVEsQ0FBQ0MsRUFBU0MsS0FFM0JMLEtBQUtDLGFBQWFTLE1BQU1ELEVBQU8sZ0JBQWlCLENBQUNGLEVBQUtDLEtBQ3BELElBQ0UsR0FBSUQsRUFDRixNQUFNQSxFQUNELENBQ0wsTUFBTUksRUFBTUgsRUFBT0ksUUFBUUMsSUFBSUMsR0FBU0EsRUFBTUMsSUFDOUNsQixrQkFBQW1CLFFBQWVPLGtCQUFtQlIsR0FBSUosSUFBT1EsS0FBS0MsSUFDaERoQixFQUFRZ0IsS0FDUEMsTUFBTWQsSUFDUCxNQUFNQSxLQUdWLE1BQU9BLEdBQ1BGLEVBQU9FLFNBT2pCaUIsUUFBQVIsUUFBZSxJQUFJbEIiLCJmaWxlIjoic2VydmljZXMvc2VhcmNoLXNlcnZpY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBTcGhpbnhDbGllbnQgZnJvbSAnc3BoaW54YXBpJ1xuaW1wb3J0IExvY2FsU2hvcFNlcnZpY2UgZnJvbSAnLi4vYXBwL2xvY2FsLXNob3Atc2VydmljZXMvbG9jYWwtc2hvcC1zZXJ2aWNlJ1xuaW1wb3J0IHByb2R1Y3RTZXJ2aWNlIGZyb20gJy4vcHJvZHVjdC1zZXJ2aWNlJ1xuLypcblRPRE86XG4gIDEuIEFkZCBwYWdpbmF0aW9uIHN1cHBvcnRcbiovXG5jbGFzcyBTZWFyY2hTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzcGhpbnhDbGllbnRcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHRoaXMuc3BoaW54Q2xpZW50ID0gbmV3IFNwaGlueENsaWVudCgpXG4gIH1cblxuICBpbml0aWFsaXplICgpIHtcbiAgICB0aGlzLnNwaGlueENsaWVudC5TZXRTZXJ2ZXIoJ2xvY2FsaG9zdCcsIDkzMTIpXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuc3BoaW54Q2xpZW50LlN0YXR1cygoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuXG4gIC8vIFRPRE86IEZvcm1hdCB0aGUgcmV0dXJuZWQgcmVzdWx0c1xuICBzZWFyY2hJblN0b2NrUHJvZHVjdHMgKHF1ZXJ5OiBzdHJpbmcpOiBQcm9taXNlPE5DUmVzcG9uc2U8eyBwcm9kdWN0czogSW5TdG9ja1Byb2R1Y3RbXSwgdG90YWxQcm9kdWN0czogbnVtYmVyIH0+PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8vIHRoaXMuc3BoaW54Q2xpZW50LlF1ZXJ5KGBTRUxFQ1QgKiBGUk9NIGluc3RvY2twcm9kdWN0cyBXSEVSRSBNQVRDSCgnJHtxdWVyeX0nKWAsIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgdGhpcy5zcGhpbnhDbGllbnQuUXVlcnkocXVlcnksICdpblN0b2NrUHJvZHVjdHMnLCAoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgaWRzID0gcmVzdWx0Lm1hdGNoZXMubWFwKG1hdGNoID0+IG1hdGNoLmlkKVxuICAgICAgICAgICAgTG9jYWxTaG9wU2VydmljZS5nZXRJblN0b2NrUHJvZHVjdHMoeyBwcm9kdWN0SWQ6IGlkcyB9KS50aGVuKHJlc3AgPT4ge1xuICAgICAgICAgICAgICByZXNvbHZlKHJlc3ApXG4gICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pXG4gIH1cblxuICBzZWFyY2hQT1Byb2R1Y3RzIChxdWVyeTogc3RyaW5nKTogUHJvbWlzZTxOQ1Jlc3BvbnNlPHsgcHJvZHVjdHM6IFBPUHJvZHVjdFtdLCB0b3RhbFByb2R1Y3RzOiBudW1iZXIgfT4+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgLy8gdGhpcy5zcGhpbnhDbGllbnQuUXVlcnkoYFNFTEVDVCAqIEZST00gaW5zdG9ja3Byb2R1Y3RzIFdIRVJFIE1BVENIKCcke3F1ZXJ5fScpYCwgKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICB0aGlzLnNwaGlueENsaWVudC5RdWVyeShxdWVyeSwgJ3BvUHJvZHVjdHMnLCAoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgaWRzID0gcmVzdWx0Lm1hdGNoZXMubWFwKG1hdGNoID0+IG1hdGNoLmlkKVxuICAgICAgICAgICAgTG9jYWxTaG9wU2VydmljZS5nZXRQT1Byb2R1Y3RzKHsgcHJvZHVjdElkOiBpZHMgfSkudGhlbihyZXNwID0+IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwKVxuICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgcmVqZWN0KGVycilcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuICB9XG5cbiAgc2VhcmNoU3ViQ2F0ZWdvcmllcyAocXVlcnk6IHN0cmluZyk6IFByb21pc2U8TkNSZXNwb25zZTxTdWJDYXRlZ29yeVtdPj4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAvLyB0aGlzLnNwaGlueENsaWVudC5RdWVyeShgU0VMRUNUICogRlJPTSBpbnN0b2NrcHJvZHVjdHMgV0hFUkUgTUFUQ0goJyR7cXVlcnl9JylgLCAoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgIHRoaXMuc3BoaW54Q2xpZW50LlF1ZXJ5KHF1ZXJ5LCAnc3ViQ2F0ZWdvcmllcycsIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHRocm93IGVyclxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpZHMgPSByZXN1bHQubWF0Y2hlcy5tYXAobWF0Y2ggPT4gbWF0Y2guaWQpXG4gICAgICAgICAgICBwcm9kdWN0U2VydmljZS5nZXRTdWJDYXRlZ29yaWVzKHsgaWQ6IGlkcyB9KS50aGVuKHJlc3AgPT4ge1xuICAgICAgICAgICAgICByZXNvbHZlKHJlc3ApXG4gICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgbmV3IFNlYXJjaFNlcnZpY2UoKVxuIl19
