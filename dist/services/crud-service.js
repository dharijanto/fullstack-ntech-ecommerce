"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const sequelize_service_1=require("./sequelize-service");let log=require("npmlog");const TAG="BaseService";class CRUDService{getModels(e){return sequelize_service_1.default.getInstance().models[e]}getSequelize(){return sequelize_service_1.default.getInstance().sequelize}errHandler(e){if(e.name)return{status:!1,errMessage:e.message};throw e}create(e,t){return log.verbose(TAG,`create(): modelName=${e} data=${JSON.stringify(t)}`),this.getModels(e).create(Object.assign(t,{id:null})).then(e=>({status:!0,data:e.get({plain:!0})})).catch(this.errHandler)}read(e,t){return log.verbose(TAG,`read(): modelName=${e} searchClause=${JSON.stringify(t)}`),this.getModels(e).findAll({where:t}).then(e=>({status:!0,data:e.map(e=>e.get({plain:!0}))})).catch(this.errHandler)}readOne(e,t){return this.getModels(e).findOne({where:t}).then(e=>e?{status:!0,data:e.get({plain:!0})}:{status:!1,errMessage:"Data not found"}).catch(this.errHandler)}rawReadQuery(e){return this.getSequelize().query(e,{type:this.getSequelize().QueryTypes.SELECT}).then(e=>({status:!0,data:e}))}rawReadOneQuery(e){return this.rawReadQuery(e).then(e=>e.status&&e.data?e.data.length?{status:!0,data:e.data[0]}:{status:!1,errMessage:"Data not found!"}:e)}update(e,t,a){return log.verbose(TAG,`update(): modelName=${e} data=${JSON.stringify(t)}`),this.getModels(e).update(t,{where:a}).spread(e=>e>0?{status:!0,data:e}:{status:!1,errMessage:"Data not found"}).catch(this.errHandler)}delete(e,t){return log.verbose(TAG,`delete(): modelName=${e} searchClause=${JSON.stringify(t)}`),this.getModels(e).destroy({where:t}).then(e=>e>0?{status:!0,data:e}:{status:!1,errMessage:"Data not found"}).catch(this.errHandler)}}exports.CRUDService=CRUDService,exports.default=CRUDService;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXJ2aWNlcy9jcnVkLXNlcnZpY2UudHMiXSwibmFtZXMiOlsic2VxdWVsaXplX3NlcnZpY2VfMSIsInJlcXVpcmUiLCJsb2ciLCJUQUciLCJDUlVEU2VydmljZSIsIltvYmplY3QgT2JqZWN0XSIsIm5hbWUiLCJkZWZhdWx0IiwiZ2V0SW5zdGFuY2UiLCJtb2RlbHMiLCJzZXF1ZWxpemUiLCJlcnIiLCJzdGF0dXMiLCJlcnJNZXNzYWdlIiwibWVzc2FnZSIsIm1vZGVsTmFtZSIsImRhdGEiLCJ2ZXJib3NlIiwiSlNPTiIsInN0cmluZ2lmeSIsInRoaXMiLCJnZXRNb2RlbHMiLCJjcmVhdGUiLCJPYmplY3QiLCJhc3NpZ24iLCJpZCIsInRoZW4iLCJjcmVhdGVkRGF0YSIsImdldCIsInBsYWluIiwiY2F0Y2giLCJlcnJIYW5kbGVyIiwic2VhcmNoQ2xhdXNlIiwiZmluZEFsbCIsIndoZXJlIiwicmVhZERhdGEiLCJtYXAiLCJmaW5kT25lIiwicXVlcnkiLCJnZXRTZXF1ZWxpemUiLCJ0eXBlIiwiUXVlcnlUeXBlcyIsIlNFTEVDVCIsInJlc3VsdCIsInJhd1JlYWRRdWVyeSIsInJlc3AiLCJsZW5ndGgiLCJ1cGRhdGUiLCJzcHJlYWQiLCJjb3VudCIsImRlc3Ryb3kiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoib0VBQUEsTUFBQUEsb0JBQUFDLFFBQUEsdUJBR0EsSUFBSUMsSUFBTUQsUUFBUSxVQUVsQixNQUFNRSxJQUFNLG9CQUVaQyxZQUNZQyxVQUFXQyxHQUNuQixPQUFPTixvQkFBQU8sUUFBaUJDLGNBQWNDLE9BQU9ILEdBR3JDRCxlQUNSLE9BQU9MLG9CQUFBTyxRQUFpQkMsY0FBY0UsVUFHOUJMLFdBQVlNLEdBQ3BCLEdBQUlBLEVBQUlMLEtBQ04sT0FBU00sUUFBUSxFQUFPQyxXQUFZRixFQUFJRyxTQUV4QyxNQUFNSCxFQUlWTixPQUE2QlUsRUFBbUJDLEdBRTlDLE9BREFkLElBQUllLFFBQVFkLDJCQUE0QlksVUFBa0JHLEtBQUtDLFVBQVVILE1BQ2pFSSxLQUFLQyxVQUFVTixHQUE4Q08sT0FBT0MsT0FBT0MsT0FBT1IsR0FBUVMsR0FBSSxRQUFTQyxLQUFLQyxLQUN6R2YsUUFBUSxFQUFNSSxLQUFNVyxFQUFZQyxLQUFNQyxPQUFPLE9BQ3JEQyxNQUFNVixLQUFLVyxZQVFoQjFCLEtBQTRCVSxFQUFtQmlCLEdBRTdDLE9BREE5QixJQUFJZSxRQUFRZCx5QkFBMEJZLGtCQUEwQkcsS0FBS0MsVUFBVWEsTUFDdkVaLEtBQUtDLFVBQVVOLEdBQThDa0IsU0FBVUMsTUFBT0YsSUFBZ0JOLEtBQUtTLEtBQ2hHdkIsUUFBUSxFQUFNSSxLQUFNbUIsRUFBU0MsSUFBSXBCLEdBQVFBLEVBQUtZLEtBQU1DLE9BQU8sUUFDbkVDLE1BQU1WLEtBQUtXLFlBR2hCMUIsUUFBK0JVLEVBQW1CaUIsR0FDaEQsT0FBUVosS0FBS0MsVUFBVU4sR0FBOENzQixTQUFVSCxNQUFPRixJQUFnQk4sS0FBS1MsR0FDckdBLEdBQ092QixRQUFRLEVBQU1JLEtBQU1tQixFQUFTUCxLQUFNQyxPQUFPLE1BRTFDakIsUUFBUSxFQUFPQyxXQUFZLG1CQUVyQ2lCLE1BQU1WLEtBQUtXLFlBR2hCMUIsYUFBY2lDLEdBQ1osT0FBT2xCLEtBQUttQixlQUFlRCxNQUFNQSxHQUFTRSxLQUFNcEIsS0FBS21CLGVBQWVFLFdBQVdDLFNBQVVoQixLQUFLaUIsS0FDbkYvQixRQUFRLEVBQU1JLEtBQU0yQixLQUlqQ3RDLGdCQUFpQmlDLEdBQ2YsT0FBT2xCLEtBQUt3QixhQUFhTixHQUFPWixLQUFLbUIsR0FDL0JBLEVBQUtqQyxRQUFVaUMsRUFBSzdCLEtBQ2pCNkIsRUFBSzdCLEtBQUs4QixRQUdKbEMsUUFBUSxFQUFNSSxLQUFNNkIsRUFBSzdCLEtBQUssS0FGOUJKLFFBQVEsRUFBT0MsV0FBWSxtQkFLL0JnQyxHQUtieEMsT0FBOEJVLEVBQW1CQyxFQUFrQmdCLEdBRWpFLE9BREE5QixJQUFJZSxRQUFRZCwyQkFBNEJZLFVBQWtCRyxLQUFLQyxVQUFVSCxNQUNqRUksS0FBS0MsVUFBVU4sR0FDcEJnQyxPQUFPL0IsR0FBUWtCLE1BQU9GLElBQXVCZ0IsT0FBUUMsR0FDaERBLEVBQVEsR0FDRHJDLFFBQVEsRUFBTUksS0FBTWlDLElBRXBCckMsUUFBUSxFQUFPQyxXQUFZLG1CQUVyQ2lCLE1BQU1WLEtBQUtXLFlBR2xCMUIsT0FBOEJVLEVBQW1CaUIsR0FFL0MsT0FEQTlCLElBQUllLFFBQVFkLDJCQUE0Qlksa0JBQTBCRyxLQUFLQyxVQUFVYSxNQUN6RVosS0FBS0MsVUFBVU4sR0FDcEJtQyxTQUFVaEIsTUFBT0YsSUFBdUJOLEtBQU11QixHQUN6Q0EsRUFBUSxHQUNEckMsUUFBUSxFQUFNSSxLQUFNaUMsSUFFcEJyQyxRQUFRLEVBQU9DLFdBQVksbUJBRXJDaUIsTUFBTVYsS0FBS1csYUF2RnBCb0IsUUFBQS9DLFlBQUFBLFlBMkZBK0MsUUFBQTVDLFFBQWVIIiwiZmlsZSI6InNlcnZpY2VzL2NydWQtc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTZXF1ZWxpemVTZXJ2aWNlIGZyb20gJy4vc2VxdWVsaXplLXNlcnZpY2UnXG5pbXBvcnQgeyBNb2RlbCwgSW5zdGFuY2UsIFdoZXJlT3B0aW9ucywgVXBkYXRlT3B0aW9ucyB9IGZyb20gJ3NlcXVlbGl6ZSdcbmltcG9ydCAqIGFzIFByb21pc2UgZnJvbSAnYmx1ZWJpcmQnXG5sZXQgbG9nID0gcmVxdWlyZSgnbnBtbG9nJylcblxuY29uc3QgVEFHID0gJ0Jhc2VTZXJ2aWNlJ1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ1JVRFNlcnZpY2Uge1xuICBwcm90ZWN0ZWQgZ2V0TW9kZWxzIChuYW1lKSB7XG4gICAgcmV0dXJuIFNlcXVlbGl6ZVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5tb2RlbHNbbmFtZV1cbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRTZXF1ZWxpemUgKCkge1xuICAgIHJldHVybiBTZXF1ZWxpemVTZXJ2aWNlLmdldEluc3RhbmNlKCkuc2VxdWVsaXplXG4gIH1cblxuICBwcm90ZWN0ZWQgZXJySGFuZGxlciAoZXJyKSB7XG4gICAgaWYgKGVyci5uYW1lKSB7XG4gICAgICByZXR1cm4geyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiBlcnIubWVzc2FnZSB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IGVyclxuICAgIH1cbiAgfVxuXG4gIGNyZWF0ZTxUIGV4dGVuZHMgQmFzZU1vZGVsPiAobW9kZWxOYW1lOiBzdHJpbmcsIGRhdGE6IFBhcnRpYWw8VD4pOiBQcm9taXNlPE5DUmVzcG9uc2U8VD4+IHtcbiAgICBsb2cudmVyYm9zZShUQUcsIGBjcmVhdGUoKTogbW9kZWxOYW1lPSR7bW9kZWxOYW1lfSBkYXRhPSR7SlNPTi5zdHJpbmdpZnkoZGF0YSl9YClcbiAgICByZXR1cm4gKHRoaXMuZ2V0TW9kZWxzKG1vZGVsTmFtZSkgYXMgTW9kZWw8SW5zdGFuY2U8VD4sIFBhcnRpYWw8VD4+KS5jcmVhdGUoT2JqZWN0LmFzc2lnbihkYXRhLCB7IGlkOiBudWxsIH0pKS50aGVuKGNyZWF0ZWREYXRhID0+IHtcbiAgICAgIHJldHVybiB7IHN0YXR1czogdHJ1ZSwgZGF0YTogY3JlYXRlZERhdGEuZ2V0KHsgcGxhaW46IHRydWUgfSkgfVxuICAgIH0pLmNhdGNoKHRoaXMuZXJySGFuZGxlcilcbiAgfVxuXG4gIC8vIElmIHRoZXJlJ3MgZGF0YSB0byBiZSByZWFkOlxuICAvLyB7c3RhdHVzOiB0cnVlLCBkYXRhOiBbXX1cbiAgLy9cbiAgLy8gSWYgdGhlcmUncyBubyBkYXRhOlxuICAvLyB7c3RhdHVzOiBmYWxzZSwgZXJyQ29kZTogLi4uLCBlcnJNZXNzYWdlOiAuLi4sIGVyckRhdGF9XG4gIHJlYWQgPFQgZXh0ZW5kcyBCYXNlTW9kZWw+IChtb2RlbE5hbWU6IHN0cmluZywgc2VhcmNoQ2xhdXNlOiBXaGVyZU9wdGlvbnM8VD4pOiBQcm9taXNlPE5DUmVzcG9uc2U8VFtdPj4ge1xuICAgIGxvZy52ZXJib3NlKFRBRywgYHJlYWQoKTogbW9kZWxOYW1lPSR7bW9kZWxOYW1lfSBzZWFyY2hDbGF1c2U9JHtKU09OLnN0cmluZ2lmeShzZWFyY2hDbGF1c2UpfWApXG4gICAgcmV0dXJuICh0aGlzLmdldE1vZGVscyhtb2RlbE5hbWUpIGFzIE1vZGVsPEluc3RhbmNlPFQ+LCBQYXJ0aWFsPFQ+PikuZmluZEFsbCh7IHdoZXJlOiBzZWFyY2hDbGF1c2UgfSkudGhlbihyZWFkRGF0YSA9PiB7XG4gICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUsIGRhdGE6IHJlYWREYXRhLm1hcChkYXRhID0+IGRhdGEuZ2V0KHsgcGxhaW46IHRydWUgfSkpIH1cbiAgICB9KS5jYXRjaCh0aGlzLmVyckhhbmRsZXIpXG4gIH1cblxuICByZWFkT25lIDxUIGV4dGVuZHMgQmFzZU1vZGVsPiAobW9kZWxOYW1lOiBzdHJpbmcsIHNlYXJjaENsYXVzZTogV2hlcmVPcHRpb25zPFQ+KTogUHJvbWlzZTxOQ1Jlc3BvbnNlPFQ+PiB7XG4gICAgcmV0dXJuICh0aGlzLmdldE1vZGVscyhtb2RlbE5hbWUpIGFzIE1vZGVsPEluc3RhbmNlPFQ+LCBQYXJ0aWFsPFQ+PikuZmluZE9uZSh7IHdoZXJlOiBzZWFyY2hDbGF1c2UgfSkudGhlbihyZWFkRGF0YSA9PiB7XG4gICAgICBpZiAocmVhZERhdGEpIHtcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhOiByZWFkRGF0YS5nZXQoeyBwbGFpbjogdHJ1ZSB9KSB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4geyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiAnRGF0YSBub3QgZm91bmQnIH1cbiAgICAgIH1cbiAgICB9KS5jYXRjaCh0aGlzLmVyckhhbmRsZXIpXG4gIH1cblxuICByYXdSZWFkUXVlcnkgKHF1ZXJ5KTogUHJvbWlzZTxOQ1Jlc3BvbnNlPGFueVtdPj4ge1xuICAgIHJldHVybiB0aGlzLmdldFNlcXVlbGl6ZSgpLnF1ZXJ5KHF1ZXJ5LCB7IHR5cGU6IHRoaXMuZ2V0U2VxdWVsaXplKCkuUXVlcnlUeXBlcy5TRUxFQ1QgfSkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhOiByZXN1bHQgfVxuICAgIH0pXG4gIH1cblxuICByYXdSZWFkT25lUXVlcnkgKHF1ZXJ5KTogUHJvbWlzZTxOQ1Jlc3BvbnNlPGFueT4+IHtcbiAgICByZXR1cm4gdGhpcy5yYXdSZWFkUXVlcnkocXVlcnkpLnRoZW4ocmVzcCA9PiB7XG4gICAgICBpZiAocmVzcC5zdGF0dXMgJiYgcmVzcC5kYXRhKSB7XG4gICAgICAgIGlmICghcmVzcC5kYXRhLmxlbmd0aCkge1xuICAgICAgICAgIHJldHVybiB7IHN0YXR1czogZmFsc2UsIGVyck1lc3NhZ2U6ICdEYXRhIG5vdCBmb3VuZCEnIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUsIGRhdGE6IHJlc3AuZGF0YVswXSB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXNwXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIHVwZGF0ZSA8VCBleHRlbmRzIEJhc2VNb2RlbD4gKG1vZGVsTmFtZTogc3RyaW5nLCBkYXRhOiBQYXJ0aWFsPFQ+LCBzZWFyY2hDbGF1c2U6IFdoZXJlT3B0aW9uczxUPik6IFByb21pc2U8TkNSZXNwb25zZTxudW1iZXI+PiB7XG4gICAgbG9nLnZlcmJvc2UoVEFHLCBgdXBkYXRlKCk6IG1vZGVsTmFtZT0ke21vZGVsTmFtZX0gZGF0YT0ke0pTT04uc3RyaW5naWZ5KGRhdGEpfWApXG4gICAgcmV0dXJuICh0aGlzLmdldE1vZGVscyhtb2RlbE5hbWUpIGFzIE1vZGVsPEluc3RhbmNlPFQ+LCBQYXJ0aWFsPFQ+PilcbiAgICAgIC51cGRhdGUoZGF0YSwgeyB3aGVyZTogc2VhcmNoQ2xhdXNlIGFzIGFueSB9KS5zcHJlYWQoKGNvdW50OiBudW1iZXIpID0+IHtcbiAgICAgICAgaWYgKGNvdW50ID4gMCkge1xuICAgICAgICAgIHJldHVybiB7IHN0YXR1czogdHJ1ZSwgZGF0YTogY291bnQgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB7IHN0YXR1czogZmFsc2UsIGVyck1lc3NhZ2U6ICdEYXRhIG5vdCBmb3VuZCcgfVxuICAgICAgICB9XG4gICAgICB9KS5jYXRjaCh0aGlzLmVyckhhbmRsZXIpXG4gIH1cblxuICBkZWxldGUgPFQgZXh0ZW5kcyBCYXNlTW9kZWw+IChtb2RlbE5hbWU6IHN0cmluZywgc2VhcmNoQ2xhdXNlOiBXaGVyZU9wdGlvbnM8VD4pOiBQcm9taXNlPE5DUmVzcG9uc2U8bnVtYmVyPj4ge1xuICAgIGxvZy52ZXJib3NlKFRBRywgYGRlbGV0ZSgpOiBtb2RlbE5hbWU9JHttb2RlbE5hbWV9IHNlYXJjaENsYXVzZT0ke0pTT04uc3RyaW5naWZ5KHNlYXJjaENsYXVzZSl9YClcbiAgICByZXR1cm4gKHRoaXMuZ2V0TW9kZWxzKG1vZGVsTmFtZSkgYXMgTW9kZWw8SW5zdGFuY2U8VD4sIFBhcnRpYWw8VD4+KVxuICAgICAgLmRlc3Ryb3koeyB3aGVyZTogc2VhcmNoQ2xhdXNlIGFzIGFueSB9KS50aGVuKChjb3VudDogbnVtYmVyKSA9PiB7XG4gICAgICAgIGlmIChjb3VudCA+IDApIHtcbiAgICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUsIGRhdGE6IGNvdW50IH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4geyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiAnRGF0YSBub3QgZm91bmQnIH1cbiAgICAgICAgfVxuICAgICAgfSkuY2F0Y2godGhpcy5lcnJIYW5kbGVyKVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENSVURTZXJ2aWNlXG4iXX0=
