"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const base_controller_1=require("../base-controller"),shop_service_1=require("../../../services/shop-service"),stock_service_1=require("../../local-shop-services/stock-service"),path=require("path");let log=require("npmlog");const TAG="MainController";class PromotionManagementController extends base_controller_1.default{constructor(e){super(Object.assign(e,{viewPath:path.join(__dirname,"../../views")})),this.imageService=new e.services.ImageService(e.db.sequelize,e.db.models),super.routeGet("/stocks",(e,t,s)=>{const o=e.query.variantId;stock_service_1.default.getStocks(o).then(t.json.bind(t)).catch(s)}),super.routeGet("/stocks-left",(e,t,s)=>{const o=e.query.variantId;stock_service_1.default.getStocksGroupedByAisle(o).then(t.json.bind(t)).catch(s)}),super.routePost("/stock",(e,t,s)=>{const o=e.query.variantId;o?stock_service_1.default.addShopStock(Object.assign({},e.body,{variantId:o})).then(t.json.bind(t)).catch(s):t.json({status:!1,errMessage:"variantId is required"})}),super.routePost("/stock/edit",(e,t,s)=>{shop_service_1.default.update("ShopStock",e.body,{id:e.body.id}).then(t.json.bind(t)).catch(s)}),super.routePost("/stock/delete",(e,t,s)=>{shop_service_1.default.delete("ShopStock",{id:e.body.id}).then(t.json.bind(t)).catch(s)}),super.routeGet("/aisle-management",(e,t,s)=>{t.render("cms/stock-management/aisle")}),super.routeGet("/aisles",(e,t,s)=>{stock_service_1.default.getAisles().then(t.json.bind(t)).catch(s)}),super.routePost("/aisle",(e,t,s)=>{stock_service_1.default.createAisle(e.body).then(t.json.bind(t)).catch(s)}),super.routePost("/aisle/edit",(e,t,s)=>{stock_service_1.default.updateAisle(e.body.id,e.body).then(t.json.bind(t)).catch(s)}),super.routePost("/aisle/delete",(e,t,s)=>{stock_service_1.default.deleteAisle(e.body.id).then(t.json.bind(t)).catch(s)}),super.routeGet("/opname",(e,t,s)=>{t.render("cms/stock-management")}),super.routeGet("/in-management",(e,t,s)=>{t.render("cms/stock-management/in")})}}exports.default=PromotionManagementController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAvY29udHJvbGxlcnMvY21zL3N0b2NrLW1hbmFnZW1lbnQtY29udHJvbGxlci50cyJdLCJuYW1lcyI6WyJiYXNlX2NvbnRyb2xsZXJfMSIsInJlcXVpcmUiLCJzaG9wX3NlcnZpY2VfMSIsInN0b2NrX3NlcnZpY2VfMSIsInBhdGgiLCJsb2ciLCJUQUciLCJQcm9tb3Rpb25NYW5hZ2VtZW50Q29udHJvbGxlciIsImRlZmF1bHQiLCJbb2JqZWN0IE9iamVjdF0iLCJzaXRlRGF0YSIsInN1cGVyIiwiT2JqZWN0IiwiYXNzaWduIiwidmlld1BhdGgiLCJqb2luIiwiX19kaXJuYW1lIiwidGhpcyIsImltYWdlU2VydmljZSIsInNlcnZpY2VzIiwiSW1hZ2VTZXJ2aWNlIiwiZGIiLCJzZXF1ZWxpemUiLCJtb2RlbHMiLCJyb3V0ZUdldCIsInJlcSIsInJlcyIsIm5leHQiLCJ2YXJpYW50SWQiLCJxdWVyeSIsImdldFN0b2NrcyIsInRoZW4iLCJqc29uIiwiYmluZCIsImNhdGNoIiwiZ2V0U3RvY2tzR3JvdXBlZEJ5QWlzbGUiLCJyb3V0ZVBvc3QiLCJhZGRTaG9wU3RvY2siLCJib2R5Iiwic3RhdHVzIiwiZXJyTWVzc2FnZSIsInVwZGF0ZSIsImlkIiwiZGVsZXRlIiwicmVuZGVyIiwiZ2V0QWlzbGVzIiwiY3JlYXRlQWlzbGUiLCJ1cGRhdGVBaXNsZSIsImRlbGV0ZUFpc2xlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Im9FQUtBLE1BQUFBLGtCQUFBQyxRQUFBLHNCQUNBQyxlQUFBRCxRQUFBLGtDQUVBRSxnQkFBQUYsUUFBQSwyQ0FJTUcsS0FBT0gsUUFBUSxRQUVyQixJQUFJSSxJQUFNSixRQUFRLFVBRWxCLE1BQU1LLElBQU0sdUJBS1pDLHNDQUEyRFAsa0JBQUFRLFFBR3pEQyxZQUFhQyxHQUNYQyxNQUFNQyxPQUFPQyxPQUFPSCxHQUFZSSxTQUFVVixLQUFLVyxLQUFLQyxVQUFXLGtCQUUvREMsS0FBS0MsYUFBZSxJQUFJUixFQUFTUyxTQUFTQyxhQUFhVixFQUFTVyxHQUFHQyxVQUFXWixFQUFTVyxHQUFHRSxRQUUxRlosTUFBTWEsU0FBUyxVQUFXLENBQUNDLEVBQUtDLEVBQUtDLEtBQ25DLE1BQU1DLEVBQVlILEVBQUlJLE1BQU1ELFVBQzVCekIsZ0JBQUFLLFFBQWtCc0IsVUFBVUYsR0FBV0csS0FBS0wsRUFBSU0sS0FBS0MsS0FBS1AsSUFBTVEsTUFBTVAsS0FHeEVoQixNQUFNYSxTQUFTLGVBQWdCLENBQUNDLEVBQUtDLEVBQUtDLEtBQ3hDLE1BQU1DLEVBQVlILEVBQUlJLE1BQU1ELFVBQzVCekIsZ0JBQUFLLFFBQWtCMkIsd0JBQXdCUCxHQUFXRyxLQUFLTCxFQUFJTSxLQUFLQyxLQUFLUCxJQUFNUSxNQUFNUCxLQUd0RmhCLE1BQU15QixVQUFVLFNBQVUsQ0FBQ1gsRUFBS0MsRUFBS0MsS0FDbkMsTUFBTUMsRUFBWUgsRUFBSUksTUFBTUQsVUFFdkJBLEVBR0h6QixnQkFBQUssUUFBa0I2QixhQUFhekIsT0FBT0MsVUFBV1ksRUFBSWEsTUFBUVYsVUFBQUEsS0FBY0csS0FBS0wsRUFBSU0sS0FBS0MsS0FBS1AsSUFBTVEsTUFBTVAsR0FGMUdELEVBQUlNLE1BQU9PLFFBQVEsRUFBT0MsV0FBWSw0QkFPMUM3QixNQUFNeUIsVUFBVSxjQUFlLENBQUNYLEVBQUtDLEVBQUtDLEtBQ3hDekIsZUFBQU0sUUFBWWlDLE9BQWtCLFlBQWFoQixFQUFJYSxNQUFRSSxHQUFJakIsRUFBSWEsS0FBS0ksS0FBTVgsS0FBS0wsRUFBSU0sS0FBS0MsS0FBS1AsSUFBTVEsTUFBTVAsS0FJM0doQixNQUFNeUIsVUFBVSxnQkFBaUIsQ0FBQ1gsRUFBS0MsRUFBS0MsS0FDMUN6QixlQUFBTSxRQUFZbUMsT0FBa0IsYUFBZUQsR0FBSWpCLEVBQUlhLEtBQUtJLEtBQU1YLEtBQUtMLEVBQUlNLEtBQUtDLEtBQUtQLElBQU1RLE1BQU1QLEtBR2pHaEIsTUFBTWEsU0FBUyxvQkFBcUIsQ0FBQ0MsRUFBS0MsRUFBS0MsS0FDN0NELEVBQUlrQixPQUFPLGdDQUdiakMsTUFBTWEsU0FBUyxVQUFXLENBQUNDLEVBQUtDLEVBQUtDLEtBQ25DeEIsZ0JBQUFLLFFBQWtCcUMsWUFBWWQsS0FBS0wsRUFBSU0sS0FBS0MsS0FBS1AsSUFBTVEsTUFBTVAsS0FHL0RoQixNQUFNeUIsVUFBVSxTQUFVLENBQUNYLEVBQUtDLEVBQUtDLEtBQ25DeEIsZ0JBQUFLLFFBQWtCc0MsWUFBWXJCLEVBQUlhLE1BQU1QLEtBQUtMLEVBQUlNLEtBQUtDLEtBQUtQLElBQU1RLE1BQU1QLEtBR3pFaEIsTUFBTXlCLFVBQVUsY0FBZSxDQUFDWCxFQUFLQyxFQUFLQyxLQUN4Q3hCLGdCQUFBSyxRQUFrQnVDLFlBQVl0QixFQUFJYSxLQUFLSSxHQUFJakIsRUFBSWEsTUFBTVAsS0FBS0wsRUFBSU0sS0FBS0MsS0FBS1AsSUFBTVEsTUFBTVAsS0FHdEZoQixNQUFNeUIsVUFBVSxnQkFBaUIsQ0FBQ1gsRUFBS0MsRUFBS0MsS0FDMUN4QixnQkFBQUssUUFBa0J3QyxZQUFZdkIsRUFBSWEsS0FBS0ksSUFBSVgsS0FBS0wsRUFBSU0sS0FBS0MsS0FBS1AsSUFBTVEsTUFBTVAsS0FHNUVoQixNQUFNYSxTQUFTLFVBQVcsQ0FBQ0MsRUFBS0MsRUFBS0MsS0FDbkNELEVBQUlrQixPQUFPLDBCQUdiakMsTUFBTWEsU0FBUyxpQkFBa0IsQ0FBQ0MsRUFBS0MsRUFBS0MsS0FFMUNELEVBQUlrQixPQUFPLDhCQWhFakJLLFFBQUF6QyxRQUFBRCIsImZpbGUiOiJhcHAvY29udHJvbGxlcnMvY21zL3N0b2NrLW1hbmFnZW1lbnQtY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcydcbmltcG9ydCAqIGFzIFByb21pc2UgZnJvbSAnYmx1ZWJpcmQnXG5pbXBvcnQgKiBhcyBwdWcgZnJvbSAncHVnJ1xuXG5pbXBvcnQgQXBwQ29uZmlnIGZyb20gJy4uLy4uLy4uL2FwcC1jb25maWcnXG5pbXBvcnQgQmFzZUNvbnRyb2xsZXIgZnJvbSAnLi4vYmFzZS1jb250cm9sbGVyJ1xuaW1wb3J0IFNob3BTZXJ2aWNlIGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3Nob3Atc2VydmljZSdcbmltcG9ydCBMb2NhbFNob3BTZXJ2aWNlIGZyb20gJy4uLy4uL2xvY2FsLXNob3Atc2VydmljZXMvbG9jYWwtc2hvcC1zZXJ2aWNlJ1xuaW1wb3J0IExvY2FsU3RvY2tTZXJ2aWNlIGZyb20gJy4uLy4uL2xvY2FsLXNob3Atc2VydmljZXMvc3RvY2stc2VydmljZSdcbmltcG9ydCB7IFNpdGVEYXRhLCBJbWFnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zaXRlLWRlZmluaXRpb25zJ1xuaW1wb3J0ICogYXMgVXRpbHMgZnJvbSAnLi4vLi4vLi4vbGlicy91dGlscydcblxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKVxuXG5sZXQgbG9nID0gcmVxdWlyZSgnbnBtbG9nJylcblxuY29uc3QgVEFHID0gJ01haW5Db250cm9sbGVyJ1xuXG4vKlxuVE9ETzogT25seSB1c2VyIHdpdGggYWRtaW4gcHJpdmlsZWdlIGNhbiBhY2Nlc3MgdGhpcyBwYWdlIVxuKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb21vdGlvbk1hbmFnZW1lbnRDb250cm9sbGVyIGV4dGVuZHMgQmFzZUNvbnRyb2xsZXIge1xuICBwcml2YXRlIGltYWdlU2VydmljZTogSW1hZ2VTZXJ2aWNlXG5cbiAgY29uc3RydWN0b3IgKHNpdGVEYXRhOiBTaXRlRGF0YSkge1xuICAgIHN1cGVyKE9iamVjdC5hc3NpZ24oc2l0ZURhdGEsIHsgdmlld1BhdGg6IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi92aWV3cycpIH0pKVxuXG4gICAgdGhpcy5pbWFnZVNlcnZpY2UgPSBuZXcgc2l0ZURhdGEuc2VydmljZXMuSW1hZ2VTZXJ2aWNlKHNpdGVEYXRhLmRiLnNlcXVlbGl6ZSwgc2l0ZURhdGEuZGIubW9kZWxzKVxuXG4gICAgc3VwZXIucm91dGVHZXQoJy9zdG9ja3MnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IHZhcmlhbnRJZCA9IHJlcS5xdWVyeS52YXJpYW50SWRcbiAgICAgIExvY2FsU3RvY2tTZXJ2aWNlLmdldFN0b2Nrcyh2YXJpYW50SWQpLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgIH0pXG5cbiAgICBzdXBlci5yb3V0ZUdldCgnL3N0b2Nrcy1sZWZ0JywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCB2YXJpYW50SWQgPSByZXEucXVlcnkudmFyaWFudElkXG4gICAgICBMb2NhbFN0b2NrU2VydmljZS5nZXRTdG9ja3NHcm91cGVkQnlBaXNsZSh2YXJpYW50SWQpLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgIH0pXG5cbiAgICBzdXBlci5yb3V0ZVBvc3QoJy9zdG9jaycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgdmFyaWFudElkID0gcmVxLnF1ZXJ5LnZhcmlhbnRJZFxuXG4gICAgICBpZiAoIXZhcmlhbnRJZCkge1xuICAgICAgICByZXMuanNvbih7IHN0YXR1czogZmFsc2UsIGVyck1lc3NhZ2U6ICd2YXJpYW50SWQgaXMgcmVxdWlyZWQnIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBMb2NhbFN0b2NrU2VydmljZS5hZGRTaG9wU3RvY2soT2JqZWN0LmFzc2lnbih7fSwgcmVxLmJvZHksIHsgdmFyaWFudElkIH0pKS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgLy8gV2Ugc2hvdWxkIG9ubHkgYmUgYWJsZSB0byB1cGRhdGUgJiBkZWxldGUgc3RvY2sgZnJvbSB0b2RheVxuICAgIHN1cGVyLnJvdXRlUG9zdCgnL3N0b2NrL2VkaXQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIFNob3BTZXJ2aWNlLnVwZGF0ZTxTaG9wU3RvY2s+KCdTaG9wU3RvY2snLCByZXEuYm9keSwgeyBpZDogcmVxLmJvZHkuaWQgfSkudGhlbihyZXMuanNvbi5iaW5kKHJlcykpLmNhdGNoKG5leHQpXG4gICAgfSlcblxuICAgIC8vIFdlIHNob3VsZCBvbmx5IGJlIGFibGUgdG8gdXBkYXRlICYgZGVsZXRlIHN0b2NrIGZyb20gdG9kYXlcbiAgICBzdXBlci5yb3V0ZVBvc3QoJy9zdG9jay9kZWxldGUnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIFNob3BTZXJ2aWNlLmRlbGV0ZTxTaG9wU3RvY2s+KCdTaG9wU3RvY2snLCB7IGlkOiByZXEuYm9keS5pZCB9KS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVHZXQoJy9haXNsZS1tYW5hZ2VtZW50JywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICByZXMucmVuZGVyKCdjbXMvc3RvY2stbWFuYWdlbWVudC9haXNsZScpXG4gICAgfSlcblxuICAgIHN1cGVyLnJvdXRlR2V0KCcvYWlzbGVzJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBMb2NhbFN0b2NrU2VydmljZS5nZXRBaXNsZXMoKS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVQb3N0KCcvYWlzbGUnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIExvY2FsU3RvY2tTZXJ2aWNlLmNyZWF0ZUFpc2xlKHJlcS5ib2R5KS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVQb3N0KCcvYWlzbGUvZWRpdCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgTG9jYWxTdG9ja1NlcnZpY2UudXBkYXRlQWlzbGUocmVxLmJvZHkuaWQsIHJlcS5ib2R5KS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVQb3N0KCcvYWlzbGUvZGVsZXRlJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBMb2NhbFN0b2NrU2VydmljZS5kZWxldGVBaXNsZShyZXEuYm9keS5pZCkudGhlbihyZXMuanNvbi5iaW5kKHJlcykpLmNhdGNoKG5leHQpXG4gICAgfSlcblxuICAgIHN1cGVyLnJvdXRlR2V0KCcvb3BuYW1lJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICByZXMucmVuZGVyKCdjbXMvc3RvY2stbWFuYWdlbWVudCcpXG4gICAgfSlcblxuICAgIHN1cGVyLnJvdXRlR2V0KCcvaW4tbWFuYWdlbWVudCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgLy8gcmVzLnNlbmQoJ2hhaGEnKVxuICAgICAgcmVzLnJlbmRlcignY21zL3N0b2NrLW1hbmFnZW1lbnQvaW4nKVxuICAgIH0pXG4gIH1cbn1cbiJdfQ==
