"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const base_controller_1=require("../base-controller"),shop_service_1=require("../../../services/shop-service"),local_shop_service_1=require("../../../services/local-shop-service"),path=require("path");let log=require("npmlog");const TAG="MainController";class ProductManagementController extends base_controller_1.default{constructor(e){super(Object.assign(e,{viewPath:path.join(__dirname,"../../views")})),super.routeGet("/",(e,o,t)=>{o.render("cms/product-management")}),super.routeGet("/products",(e,o,t)=>{local_shop_service_1.default.getShopifiedProducts().then(o.json.bind(o)).catch(t)}),super.routePost("/product/edit",(e,o,t)=>{const r=e.body.id,s={price:e.body.shopPrice,preOrderAllowed:e.body.preOrderAllowed,preOrderDuration:e.body.preOrderDuration,disabled:e.body.disabled};local_shop_service_1.default.updateProduct(r,s).then(o.json.bind(o)).catch(t)}),super.routeGet("/variants",(e,o,t)=>{const r=e.query.productId;local_shop_service_1.default.getShopifiedVariants(r).then(o.json.bind(o)).catch(t)}),super.routeGet("/shop-stocks",(e,o,t)=>{local_shop_service_1.default.getShopStock().then(o.json.bind(o)).catch(t)}),super.routePost("/shop-stock",(e,o,t)=>{const r=e.query.variantId;r?local_shop_service_1.default.addShopStock(Object.assign({},e.body,{variantId:r})).then(o.json.bind(o)).catch(t):o.json({status:!1,errMessage:"variantId is required"})}),super.routePost("/shop-stock/edit",(e,o,t)=>{shop_service_1.default.update("ShopStock",e.body,{id:e.body.id}).then(o.json.bind(o)).catch(t)}),super.routePost("/shop-stock/delete",(e,o,t)=>{shop_service_1.default.delete("ShopStock",{id:e.body.id}).then(o.json.bind(o)).catch(t)})}}exports.default=ProductManagementController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAvY29udHJvbGxlcnMvY21zL3Byb2R1Y3QtbWFuYWdlbWVudC1jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbImJhc2VfY29udHJvbGxlcl8xIiwicmVxdWlyZSIsInNob3Bfc2VydmljZV8xIiwibG9jYWxfc2hvcF9zZXJ2aWNlXzEiLCJwYXRoIiwibG9nIiwiVEFHIiwiUHJvZHVjdE1hbmFnZW1lbnRDb250cm9sbGVyIiwiZGVmYXVsdCIsIltvYmplY3QgT2JqZWN0XSIsInNpdGVEYXRhIiwic3VwZXIiLCJPYmplY3QiLCJhc3NpZ24iLCJ2aWV3UGF0aCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJyb3V0ZUdldCIsInJlcSIsInJlcyIsIm5leHQiLCJyZW5kZXIiLCJnZXRTaG9waWZpZWRQcm9kdWN0cyIsInRoZW4iLCJqc29uIiwiYmluZCIsImNhdGNoIiwicm91dGVQb3N0IiwicHJvZHVjdElkIiwiYm9keSIsImlkIiwiZGF0YSIsInByaWNlIiwicHJlT3JkZXJBbGxvd2VkIiwicHJlT3JkZXJEdXJhdGlvbiIsImRpc2FibGVkIiwidXBkYXRlUHJvZHVjdCIsInF1ZXJ5IiwiZ2V0U2hvcGlmaWVkVmFyaWFudHMiLCJnZXRTaG9wU3RvY2siLCJ2YXJpYW50SWQiLCJhZGRTaG9wU3RvY2siLCJzdGF0dXMiLCJlcnJNZXNzYWdlIiwidXBkYXRlIiwiZGVsZXRlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Im9FQUlBLE1BQUFBLGtCQUFBQyxRQUFBLHNCQUNBQyxlQUFBRCxRQUFBLGtDQUNBRSxxQkFBQUYsUUFBQSx3Q0FLTUcsS0FBT0gsUUFBUSxRQUVyQixJQUFJSSxJQUFNSixRQUFRLFVBRWxCLE1BQU1LLElBQU0sdUJBS1pDLG9DQUF5RFAsa0JBQUFRLFFBQ3ZEQyxZQUFhQyxHQUNYQyxNQUFNQyxPQUFPQyxPQUFPSCxHQUFZSSxTQUFVVixLQUFLVyxLQUFLQyxVQUFXLGtCQUUvREwsTUFBTU0sU0FBUyxJQUFLLENBQUNDLEVBQUtDLEVBQUtDLEtBQzdCRCxFQUFJRSxPQUFPLDRCQUdiVixNQUFNTSxTQUFTLFlBQWEsQ0FBQ0MsRUFBS0MsRUFBS0MsS0FDckNqQixxQkFBQUssUUFBaUJjLHVCQUF1QkMsS0FBS0osRUFBSUssS0FBS0MsS0FBS04sSUFBTU8sTUFBTU4sS0FHekVULE1BQU1nQixVQUFVLGdCQUFpQixDQUFDVCxFQUFLQyxFQUFLQyxLQUMxQyxNQUFNUSxFQUFZVixFQUFJVyxLQUFLQyxHQUNyQkMsR0FDSkMsTUFBT2QsRUFBSVcsS0FBZ0IsVUFDM0JJLGdCQUFpQmYsRUFBSVcsS0FBc0IsZ0JBQzNDSyxpQkFBa0JoQixFQUFJVyxLQUF1QixpQkFDN0NNLFNBQVVqQixFQUFJVyxLQUFlLFVBRy9CMUIscUJBQUFLLFFBQWlCNEIsY0FBY1IsRUFBV0csR0FBTVIsS0FBS0osRUFBSUssS0FBS0MsS0FBS04sSUFBTU8sTUFBTU4sS0FHakZULE1BQU1NLFNBQVMsWUFBYSxDQUFDQyxFQUFLQyxFQUFLQyxLQUNyQyxNQUFNUSxFQUFZVixFQUFJbUIsTUFBTVQsVUFDNUJ6QixxQkFBQUssUUFBaUI4QixxQkFBcUJWLEdBQVdMLEtBQUtKLEVBQUlLLEtBQUtDLEtBQUtOLElBQU1PLE1BQU1OLEtBR2xGVCxNQUFNTSxTQUFTLGVBQWdCLENBQUNDLEVBQUtDLEVBQUtDLEtBQ3hDakIscUJBQUFLLFFBQWlCK0IsZUFBZWhCLEtBQUtKLEVBQUlLLEtBQUtDLEtBQUtOLElBQU1PLE1BQU1OLEtBSWpFVCxNQUFNZ0IsVUFBVSxjQUFlLENBQUNULEVBQUtDLEVBQUtDLEtBQ3hDLE1BQU1vQixFQUFZdEIsRUFBSW1CLE1BQU1HLFVBRXZCQSxFQUdIckMscUJBQUFLLFFBQWlCaUMsYUFBYTdCLE9BQU9DLFVBQVdLLEVBQUlXLE1BQVFXLFVBQUFBLEtBQWNqQixLQUFLSixFQUFJSyxLQUFLQyxLQUFLTixJQUFNTyxNQUFNTixHQUZ6R0QsRUFBSUssTUFBT2tCLFFBQVEsRUFBT0MsV0FBWSw0QkFPMUNoQyxNQUFNZ0IsVUFBVSxtQkFBb0IsQ0FBQ1QsRUFBS0MsRUFBS0MsS0FDN0NsQixlQUFBTSxRQUFZb0MsT0FBa0IsWUFBYTFCLEVBQUlXLE1BQVFDLEdBQUlaLEVBQUlXLEtBQUtDLEtBQU1QLEtBQUtKLEVBQUlLLEtBQUtDLEtBQUtOLElBQU1PLE1BQU1OLEtBSTNHVCxNQUFNZ0IsVUFBVSxxQkFBc0IsQ0FBQ1QsRUFBS0MsRUFBS0MsS0FDL0NsQixlQUFBTSxRQUFZcUMsT0FBa0IsYUFBZWYsR0FBSVosRUFBSVcsS0FBS0MsS0FBTVAsS0FBS0osRUFBSUssS0FBS0MsS0FBS04sSUFBTU8sTUFBTU4sTUFuRHJHMEIsUUFBQXRDLFFBQUFEIiwiZmlsZSI6ImFwcC9jb250cm9sbGVycy9jbXMvcHJvZHVjdC1tYW5hZ2VtZW50LWNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBleHByZXNzIGZyb20gJ2V4cHJlc3MnXG5pbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gJ2JsdWViaXJkJ1xuaW1wb3J0ICogYXMgcHVnIGZyb20gJ3B1ZydcblxuaW1wb3J0IEJhc2VDb250cm9sbGVyIGZyb20gJy4uL2Jhc2UtY29udHJvbGxlcidcbmltcG9ydCBTaG9wU2VydmljZSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9zaG9wLXNlcnZpY2UnXG5pbXBvcnQgTG9jYWxTaG9wU2VydmljZSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9sb2NhbC1zaG9wLXNlcnZpY2UnXG5pbXBvcnQgeyBTaXRlRGF0YSB9IGZyb20gJy4uLy4uLy4uL3NpdGUtZGVmaW5pdGlvbnMnXG5pbXBvcnQgKiBhcyBVdGlscyBmcm9tICcuLi8uLi8uLi9saWJzL3V0aWxzJ1xuaW1wb3J0IE9yZGVyU2VydmljZSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9sb2NhbC1zaG9wL29yZGVyLXNlcnZpY2UnXG5cbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcblxubGV0IGxvZyA9IHJlcXVpcmUoJ25wbWxvZycpXG5cbmNvbnN0IFRBRyA9ICdNYWluQ29udHJvbGxlcidcblxuLypcblRPRE86IE9ubHkgdXNlciB3aXRoIGFkbWluIHByaXZpbGVnZSBjYW4gYWNjZXNzIHRoaXMgcGFnZSFcbiovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQcm9kdWN0TWFuYWdlbWVudENvbnRyb2xsZXIgZXh0ZW5kcyBCYXNlQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yIChzaXRlRGF0YTogU2l0ZURhdGEpIHtcbiAgICBzdXBlcihPYmplY3QuYXNzaWduKHNpdGVEYXRhLCB7IHZpZXdQYXRoOiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vdmlld3MnKSB9KSlcblxuICAgIHN1cGVyLnJvdXRlR2V0KCcvJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICByZXMucmVuZGVyKCdjbXMvcHJvZHVjdC1tYW5hZ2VtZW50JylcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVHZXQoJy9wcm9kdWN0cycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgTG9jYWxTaG9wU2VydmljZS5nZXRTaG9waWZpZWRQcm9kdWN0cygpLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgIH0pXG5cbiAgICBzdXBlci5yb3V0ZVBvc3QoJy9wcm9kdWN0L2VkaXQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IHByb2R1Y3RJZCA9IHJlcS5ib2R5LmlkXG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICBwcmljZTogcmVxLmJvZHlbJ3Nob3BQcmljZSddLFxuICAgICAgICBwcmVPcmRlckFsbG93ZWQ6IHJlcS5ib2R5WydwcmVPcmRlckFsbG93ZWQnXSxcbiAgICAgICAgcHJlT3JkZXJEdXJhdGlvbjogcmVxLmJvZHlbJ3ByZU9yZGVyRHVyYXRpb24nXSxcbiAgICAgICAgZGlzYWJsZWQ6IHJlcS5ib2R5WydkaXNhYmxlZCddXG4gICAgICB9XG5cbiAgICAgIExvY2FsU2hvcFNlcnZpY2UudXBkYXRlUHJvZHVjdChwcm9kdWN0SWQsIGRhdGEpLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgIH0pXG5cbiAgICBzdXBlci5yb3V0ZUdldCgnL3ZhcmlhbnRzJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSByZXEucXVlcnkucHJvZHVjdElkXG4gICAgICBMb2NhbFNob3BTZXJ2aWNlLmdldFNob3BpZmllZFZhcmlhbnRzKHByb2R1Y3RJZCkudGhlbihyZXMuanNvbi5iaW5kKHJlcykpLmNhdGNoKG5leHQpXG4gICAgfSlcblxuICAgIHN1cGVyLnJvdXRlR2V0KCcvc2hvcC1zdG9ja3MnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIExvY2FsU2hvcFNlcnZpY2UuZ2V0U2hvcFN0b2NrKCkudGhlbihyZXMuanNvbi5iaW5kKHJlcykpLmNhdGNoKG5leHQpXG5cbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVQb3N0KCcvc2hvcC1zdG9jaycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgdmFyaWFudElkID0gcmVxLnF1ZXJ5LnZhcmlhbnRJZFxuXG4gICAgICBpZiAoIXZhcmlhbnRJZCkge1xuICAgICAgICByZXMuanNvbih7IHN0YXR1czogZmFsc2UsIGVyck1lc3NhZ2U6ICd2YXJpYW50SWQgaXMgcmVxdWlyZWQnIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBMb2NhbFNob3BTZXJ2aWNlLmFkZFNob3BTdG9jayhPYmplY3QuYXNzaWduKHt9LCByZXEuYm9keSwgeyB2YXJpYW50SWQgfSkpLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgICAgfVxuICAgIH0pXG5cbiAgICAvLyBXZSBzaG91bGQgb25seSBiZSBhYmxlIHRvIHVwZGF0ZSAmIGRlbGV0ZSBzdG9jayBmcm9tIHRvZGF5XG4gICAgc3VwZXIucm91dGVQb3N0KCcvc2hvcC1zdG9jay9lZGl0JywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBTaG9wU2VydmljZS51cGRhdGU8U2hvcFN0b2NrPignU2hvcFN0b2NrJywgcmVxLmJvZHksIHsgaWQ6IHJlcS5ib2R5LmlkIH0pLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgIH0pXG5cbiAgICAvLyBXZSBzaG91bGQgb25seSBiZSBhYmxlIHRvIHVwZGF0ZSAmIGRlbGV0ZSBzdG9jayBmcm9tIHRvZGF5XG4gICAgc3VwZXIucm91dGVQb3N0KCcvc2hvcC1zdG9jay9kZWxldGUnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIFNob3BTZXJ2aWNlLmRlbGV0ZTxTaG9wU3RvY2s+KCdTaG9wU3RvY2snLCB7IGlkOiByZXEuYm9keS5pZCB9KS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICB9KVxuXG4gIH1cbn1cbiJdfQ==
