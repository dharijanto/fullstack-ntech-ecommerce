"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const base_controller_1=require("./base-controller"),shop_service_1=require("../../services/shop-service");let log=require("npmlog");const TAG="ProductManagementController";class ShopManagementController extends base_controller_1.default{constructor(e){super(e,!1),super.routeGet("/",(e,o,s)=>{o.render("shop-management")}),super.routeGet("/promotion-management",(e,o,s)=>{o.render("promotion-management")}),super.routeGet("/promotion",(e,o,s)=>{const t=e.query.shopId;t?shop_service_1.default.getPromotion(t).then(o.json.bind(o)).catch(s):o.json({status:!1,errMessage:"shopId is required!"})}),super.routePost("/promotion",(e,o,s)=>{const t=e.query.shopId,r=e.query.productId;console.dir(e.query),t&&r?shop_service_1.default.create("Promotion",Object.assign({shopId:t,productId:r},e.body)).then(o.json.bind(o)).catch(s):o.json({status:!1,errMessage:"shopId and productId are required"})}),super.routePost("/promotion/edit",(e,o,s)=>{const t=e.query.shopId,r=e.query.productId;console.dir(e.query),t&&r?shop_service_1.default.update("Promotion",Object.assign({shopId:t,productId:r},e.body),{id:e.body.id}).then(o.json.bind(o)).catch(s):o.json({status:!1,errMessage:"shopId and productId are required"})}),super.routePost("/promotion/delete",(e,o,s)=>{console.dir(e.query),shop_service_1.default.delete("Promotion",{id:e.body.id}).then(o.json.bind(o)).catch(s)}),super.routeGet("/shops",(e,o,s)=>{shop_service_1.default.getShops().then(e=>{o.json(e)}).catch(s)}),super.routePost("/shop",(e,o,s)=>{shop_service_1.default.create("Shop",e.body).then(o.json.bind(o)).catch(s)}),super.routePost("/shop/edit",(e,o,s)=>{shop_service_1.default.update("Shop",e.body,{id:e.body.id}).then(o.json.bind(o)).catch(s)}),super.routePost("/shop/delete",(e,o,s)=>{shop_service_1.default.delete("Shop",{id:e.body.id}).then(o.json.bind(o)).catch(s)}),super.routeGet("/products",(e,o,s)=>{const t=e.query.shopId;t?shop_service_1.default.getShopifiedProducts(t).then(o.json.bind(o)).catch(s):o.json({status:!1,errMessage:"shopId is required!"})}),super.routeGet("/variants",(e,o,s)=>{const t=e.query.shopId,r=e.query.productId;t?shop_service_1.default.getShopifiedVariants(t,r).then(o.json.bind(o)).catch(s):o.json({status:!1,errMessage:"shopId is required!"})}),super.routeGet("/shop-stocks",(e,o,s)=>{const t=e.query.shopId;t?shop_service_1.default.getShopStock(t).then(o.json.bind(o)).catch(s):o.json({status:!1,errMessage:"shopId is required"})})}}exports.default=ShopManagementController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbXMvY29udHJvbGxlcnMvc2hvcC1tYW5hZ2VtZW50LWNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiYmFzZV9jb250cm9sbGVyXzEiLCJyZXF1aXJlIiwic2hvcF9zZXJ2aWNlXzEiLCJsb2ciLCJUQUciLCJTaG9wTWFuYWdlbWVudENvbnRyb2xsZXIiLCJkZWZhdWx0IiwiW29iamVjdCBPYmplY3RdIiwiaW5pdERhdGEiLCJzdXBlciIsInJvdXRlR2V0IiwicmVxIiwicmVzIiwibmV4dCIsInJlbmRlciIsInNob3BJZCIsInF1ZXJ5IiwiZ2V0UHJvbW90aW9uIiwidGhlbiIsImpzb24iLCJiaW5kIiwiY2F0Y2giLCJzdGF0dXMiLCJlcnJNZXNzYWdlIiwicm91dGVQb3N0IiwicHJvZHVjdElkIiwiY29uc29sZSIsImRpciIsImNyZWF0ZSIsIk9iamVjdCIsImFzc2lnbiIsImJvZHkiLCJ1cGRhdGUiLCJpZCIsImRlbGV0ZSIsImdldFNob3BzIiwicmVzcCIsImdldFNob3BpZmllZFByb2R1Y3RzIiwiZ2V0U2hvcGlmaWVkVmFyaWFudHMiLCJnZXRTaG9wU3RvY2siLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoib0VBQ0EsTUFBQUEsa0JBQUFDLFFBQUEscUJBS0FDLGVBQUFELFFBQUEsK0JBRUEsSUFBSUUsSUFBTUYsUUFBUSxVQUVsQixNQUFNRyxJQUFNLG9DQUNaQyxpQ0FBc0RMLGtCQUFBTSxRQUNwREMsWUFBYUMsR0FDWEMsTUFBTUQsR0FBVSxHQUNoQkMsTUFBTUMsU0FBUyxJQUFLLENBQUNDLEVBQUtDLEVBQUtDLEtBQzdCRCxFQUFJRSxPQUFPLHFCQUdiTCxNQUFNQyxTQUFTLHdCQUF5QixDQUFDQyxFQUFLQyxFQUFLQyxLQUNqREQsRUFBSUUsT0FBTywwQkFHYkwsTUFBTUMsU0FBUyxhQUFjLENBQUNDLEVBQUtDLEVBQUtDLEtBQ3RDLE1BQU1FLEVBQVNKLEVBQUlLLE1BQU1ELE9BQ3BCQSxFQUdIYixlQUFBSSxRQUFZVyxhQUFhRixH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QUN4QyxNQUFNRSxFQUFTSixFQUFJSyxNQUFNRCxPQUNwQkEsRUFHSGIsZUFBQUksUUFBWWlDLGFBQWF4QixHQUFRRyxLQUFLTixFQUFJTyxLQUFLQyxLQUFLUixJQUFNUyxNQUFNUixHQUZoRUQsRUFBSU8sTUFBT0csUUFBUSxFQUFPQyxXQUFZLDBCQTNHOUNpQixRQUFBbEMsUUFBQUQiLCJmaWxlIjoiY21zL2NvbnRyb2xsZXJzL3Nob3AtbWFuYWdlbWVudC1jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IEJhc2VDb250cm9sbGVyIGZyb20gJy4vYmFzZS1jb250cm9sbGVyJ1xuaW1wb3J0IFByb2R1Y3RTZXJ2aWNlIGZyb20gJy4uLy4uL3NlcnZpY2VzL3Byb2R1Y3Qtc2VydmljZSdcbmltcG9ydCB7IEltYWdlU2VydmljZSB9IGZyb20gJy4uLy4uL3NpdGUtZGVmaW5pdGlvbnMnXG5cbmltcG9ydCBBcHBDb25maWcgZnJvbSAnLi4vLi4vYXBwLWNvbmZpZydcbmltcG9ydCBTaG9wU2VydmljZSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zaG9wLXNlcnZpY2UnXG5cbmxldCBsb2cgPSByZXF1aXJlKCducG1sb2cnKVxuXG5jb25zdCBUQUcgPSAnUHJvZHVjdE1hbmFnZW1lbnRDb250cm9sbGVyJ1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2hvcE1hbmFnZW1lbnRDb250cm9sbGVyIGV4dGVuZHMgQmFzZUNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvciAoaW5pdERhdGEpIHtcbiAgICBzdXBlcihpbml0RGF0YSwgZmFsc2UpXG4gICAgc3VwZXIucm91dGVHZXQoJy8nLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIHJlcy5yZW5kZXIoJ3Nob3AtbWFuYWdlbWVudCcpXG4gICAgfSlcblxuICAgIHN1cGVyLnJvdXRlR2V0KCcvcHJvbW90aW9uLW1hbmFnZW1lbnQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIHJlcy5yZW5kZXIoJ3Byb21vdGlvbi1tYW5hZ2VtZW50JylcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVHZXQoJy9wcm9tb3Rpb24nLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IHNob3BJZCA9IHJlcS5xdWVyeS5zaG9wSWRcbiAgICAgIGlmICghc2hvcElkKSB7XG4gICAgICAgIHJlcy5qc29uKHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogJ3Nob3BJZCBpcyByZXF1aXJlZCEnIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBTaG9wU2VydmljZS5nZXRQcm9tb3Rpb24oc2hvcElkKS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVQb3N0KCcvcHJvbW90aW9uJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCBzaG9wSWQgPSByZXEucXVlcnkuc2hvcElkXG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSByZXEucXVlcnkucHJvZHVjdElkXG4gICAgICBjb25zb2xlLmRpcihyZXEucXVlcnkpXG4gICAgICBpZiAoIXNob3BJZCB8fCAhcHJvZHVjdElkKSB7XG4gICAgICAgIHJlcy5qc29uKHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogJ3Nob3BJZCBhbmQgcHJvZHVjdElkIGFyZSByZXF1aXJlZCcgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIFNob3BTZXJ2aWNlLmNyZWF0ZTxQcm9tb3Rpb24+KCdQcm9tb3Rpb24nLCBPYmplY3QuYXNzaWduKHsgc2hvcElkLCBwcm9kdWN0SWQgfSwgcmVxLmJvZHkpKVxuICAgICAgICAgIC50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVQb3N0KCcvcHJvbW90aW9uL2VkaXQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IHNob3BJZCA9IHJlcS5xdWVyeS5zaG9wSWRcbiAgICAgIGNvbnN0IHByb2R1Y3RJZCA9IHJlcS5xdWVyeS5wcm9kdWN0SWRcbiAgICAgIGNvbnNvbGUuZGlyKHJlcS5xdWVyeSlcbiAgICAgIGlmICghc2hvcElkIHx8ICFwcm9kdWN0SWQpIHtcbiAgICAgICAgcmVzLmpzb24oeyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiAnc2hvcElkIGFuZCBwcm9kdWN0SWQgYXJlIHJlcXVpcmVkJyB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgU2hvcFNlcnZpY2UudXBkYXRlPFByb21vdGlvbj4oJ1Byb21vdGlvbicsXG4gICAgICAgICBPYmplY3QuYXNzaWduKHsgc2hvcElkLCBwcm9kdWN0SWQgfSwgcmVxLmJvZHkpLFxuICAgICAgICAgeyBpZDogcmVxLmJvZHkuaWQgfSkudGhlbihyZXMuanNvbi5iaW5kKHJlcykpLmNhdGNoKG5leHQpXG4gICAgICB9XG4gICAgfSlcblxuICAgIHN1cGVyLnJvdXRlUG9zdCgnL3Byb21vdGlvbi9kZWxldGUnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnNvbGUuZGlyKHJlcS5xdWVyeSlcbiAgICAgIFNob3BTZXJ2aWNlLmRlbGV0ZTxQcm9tb3Rpb24+KCdQcm9tb3Rpb24nLCB7IGlkOiByZXEuYm9keS5pZCB9KS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVHZXQoJy9zaG9wcycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgU2hvcFNlcnZpY2UuZ2V0U2hvcHMoKS50aGVuKHJlc3AgPT4ge1xuICAgICAgICByZXMuanNvbihyZXNwKVxuICAgICAgfSkuY2F0Y2gobmV4dClcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVQb3N0KCcvc2hvcCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgU2hvcFNlcnZpY2UuY3JlYXRlPFNob3A+KCdTaG9wJywgcmVxLmJvZHkpLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgIH0pXG5cbiAgICBzdXBlci5yb3V0ZVBvc3QoJy9zaG9wL2VkaXQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIFNob3BTZXJ2aWNlLnVwZGF0ZTxTaG9wPignU2hvcCcsIHJlcS5ib2R5LCB7IGlkOiByZXEuYm9keS5pZCB9KS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVQb3N0KCcvc2hvcC9kZWxldGUnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIFNob3BTZXJ2aWNlLmRlbGV0ZTxTaG9wPignU2hvcCcsIHsgaWQ6IHJlcS5ib2R5LmlkIH0pLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgIH0pXG5cbiAgICBzdXBlci5yb3V0ZUdldCgnL3Byb2R1Y3RzJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCBzaG9wSWQgPSByZXEucXVlcnkuc2hvcElkXG4gICAgICBpZiAoc2hvcElkKSB7XG4gICAgICAgIFNob3BTZXJ2aWNlLmdldFNob3BpZmllZFByb2R1Y3RzKHNob3BJZCkudGhlbihyZXMuanNvbi5iaW5kKHJlcykpLmNhdGNoKG5leHQpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuanNvbih7IHN0YXR1czogZmFsc2UsIGVyck1lc3NhZ2U6ICdzaG9wSWQgaXMgcmVxdWlyZWQhJyB9KVxuICAgICAgfVxuICAgIH0pXG5cbiAgICAvKiBzdXBlci5yb3V0ZVBvc3QoJy9wcm9kdWN0L2VkaXQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IHNob3BJZCA9IHJlcS5xdWVyeS5zaG9wSWRcbiAgICAgIGNvbnN0IHByb2R1Y3RJZCA9IHJlcS5ib2R5LmlkXG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICBwcmljZTogcmVxLmJvZHlbJ3Nob3BQcmljZSddLFxuICAgICAgICBwcmVPcmRlckFsbG93ZWQ6IHJlcS5ib2R5WydwcmVPcmRlckFsbG93ZWQnXSxcbiAgICAgICAgcHJlT3JkZXJEdXJhdGlvbjogcmVxLmJvZHlbJ3ByZU9yZGVyRHVyYXRpb24nXSxcbiAgICAgICAgZGlzYWJsZWQ6IHJlcS5ib2R5WydkaXNhYmxlZCddXG4gICAgICB9XG5cbiAgICAgIGlmIChzaG9wSWQpIHtcbiAgICAgICAgU2hvcFNlcnZpY2UudXBkYXRlUHJvZHVjdChzaG9wSWQsIHByb2R1Y3RJZCwgZGF0YSkudGhlbihyZXMuanNvbi5iaW5kKHJlcykpLmNhdGNoKG5leHQpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuanNvbih7IHN0YXR1czogZmFsc2UsIGVyck1lc3NhZ2U6ICdzaG9wSWQgaXMgcmVxdWlyZWQhJyB9KVxuICAgICAgfVxuICAgIH0pICovXG5cbiAgICBzdXBlci5yb3V0ZUdldCgnL3ZhcmlhbnRzJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCBzaG9wSWQgPSByZXEucXVlcnkuc2hvcElkXG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSByZXEucXVlcnkucHJvZHVjdElkXG4gICAgICBpZiAoc2hvcElkKSB7XG4gICAgICAgIFNob3BTZXJ2aWNlLmdldFNob3BpZmllZFZhcmlhbnRzKHNob3BJZCwgcHJvZHVjdElkKS50aGVuKHJlcy5qc29uLmJpbmQocmVzKSkuY2F0Y2gobmV4dClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcy5qc29uKHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogJ3Nob3BJZCBpcyByZXF1aXJlZCEnIH0pXG4gICAgICB9XG4gICAgfSlcblxuICAgIHN1cGVyLnJvdXRlR2V0KCcvc2hvcC1zdG9ja3MnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IHNob3BJZCA9IHJlcS5xdWVyeS5zaG9wSWRcbiAgICAgIGlmICghc2hvcElkKSB7XG4gICAgICAgIHJlcy5qc29uKHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogJ3Nob3BJZCBpcyByZXF1aXJlZCcgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIFNob3BTZXJ2aWNlLmdldFNob3BTdG9jayhzaG9wSWQpLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgICAgfVxuICAgIH0pXG5cbiAgICAvKiBzdXBlci5yb3V0ZVBvc3QoJy9zaG9wLXN0b2NrJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCB2YXJpYW50SWQgPSByZXEucXVlcnkudmFyaWFudElkXG4gICAgICBjb25zdCBzaG9wSWQgPSByZXEucXVlcnkuc2hvcElkXG5cbiAgICAgIGlmICghdmFyaWFudElkIHx8ICFzaG9wSWQpIHtcbiAgICAgICAgcmVzLmpzb24oeyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiAndmFyaWFudElkIGFuZCBzaG9wSWQgYXJlIHJlcXVpcmVkJyB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgU2hvcFNlcnZpY2UuYWRkU2hvcFN0b2NrKE9iamVjdC5hc3NpZ24oeyBzaG9wSWQsIHZhcmlhbnRJZCB9LCByZXEuYm9keSkpLnRoZW4ocmVzLmpzb24uYmluZChyZXMpKS5jYXRjaChuZXh0KVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBzdXBlci5yb3V0ZVBvc3QoJy9zaG9wLXN0b2NrL2VkaXQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIFNob3BTZXJ2aWNlLnVwZGF0ZTxTaG9wU3RvY2s+KCdTaG9wU3RvY2snLCByZXEuYm9keSwgeyBpZDogcmVxLmJvZHkuaWQgfSkudGhlbihyZXMuanNvbi5iaW5kKHJlcykpLmNhdGNoKG5leHQpXG4gICAgfSlcblxuICAgIHN1cGVyLnJvdXRlUG9zdCgnL3Nob3Atc3RvY2svZGVsZXRlJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBTaG9wU2VydmljZS5kZWxldGU8U2hvcFN0b2NrPignU2hvcFN0b2NrJywgeyBpZDogcmVxLmJvZHkuaWQgfSkudGhlbihyZXMuanNvbi5iaW5kKHJlcykpLmNhdGNoKG5leHQpXG4gICAgfSkgKi9cbiAgfVxuXG59XG4iXX0=
