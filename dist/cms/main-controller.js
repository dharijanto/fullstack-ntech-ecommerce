"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const base_controller_1=require("./controllers/base-controller"),order_management_controller_1=require("./controllers/order-management-controller"),account_management_controller_1=require("./controllers/account-management-controller"),product_management_controller_1=require("./controllers/product-management-controller"),shop_management_controller_1=require("./controllers/shop-management-controller"),supplier_management_controller_1=require("./controllers/supplier-management-controller"),sql_view_service_1=require("../services/sql-view-service"),Utils=require("../libs/utils"),app_config_1=require("../app-config"),log=require("npmlog"),TAG="MainController";class MainController extends base_controller_1.default{constructor(e){super(e),this.imageService=new e.services.ImageService(e.db.sequelize,e.db.models),this.imageURLFormatter=(e=>`${app_config_1.default.BASE_URL}${app_config_1.default.IMAGE_MOUNT_PATH}${e}`),this.addInterceptor((e,t,r)=>{log.verbose(TAG,"req.path="+e.path),t.locals.siteHash=this.siteHash,r()}),this.routePost("/image/get-url",(e,t,r)=>{const o=e.body.filename;t.json({status:!0,data:Utils.getImageURL(o)})}),super.routeGet("/images",(e,t,r)=>{this.imageService.getImages(this.imageURLFormatter).then(e=>{log.verbose(TAG,"/images.GET():"+JSON.stringify(e)),t.json(e)}).catch(r)}),super.routePost("/image",this.imageService.getExpressUploadMiddleware(app_config_1.default.IMAGE_PATH,this.imageURLFormatter)),super.routePost("/image/delete",(e,t,r)=>{log.verbose(TAG,"image/delete.POST: req.body="+JSON.stringify(e.body)),this.imageService.deleteImage(app_config_1.default.IMAGE_PATH,e.body.filename).then(e=>{t.json(e)}).catch(r)}),this.routeGet("/",(e,t,r)=>{t.locals.renderSidebar=!0,t.render("product-management")}),this.routeGet("/populate-views",(e,t,r)=>{sql_view_service_1.default.populateViews().then(e=>{t.json(e)}).catch(r)}),this.routeUse("/product-management",new product_management_controller_1.default(e).getRouter()),this.routeUse("/shop-management",new shop_management_controller_1.default(e).getRouter()),this.routeUse("/supplier-management",new supplier_management_controller_1.default(e).getRouter()),this.routeUse("/order-management",new order_management_controller_1.default(e).getRouter()),this.routeUse("/account-management",new account_management_controller_1.default(e).getRouter())}}module.exports=MainController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbXMvbWFpbi1jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbImJhc2VfY29udHJvbGxlcl8xIiwicmVxdWlyZSIsIm9yZGVyX21hbmFnZW1lbnRfY29udHJvbGxlcl8xIiwiYWNjb3VudF9tYW5hZ2VtZW50X2NvbnRyb2xsZXJfMSIsInByb2R1Y3RfbWFuYWdlbWVudF9jb250cm9sbGVyXzEiLCJzaG9wX21hbmFnZW1lbnRfY29udHJvbGxlcl8xIiwic3VwcGxpZXJfbWFuYWdlbWVudF9jb250cm9sbGVyXzEiLCJzcWxfdmlld19zZXJ2aWNlXzEiLCJVdGlscyIsImFwcF9jb25maWdfMSIsImxvZyIsIlRBRyIsIk1haW5Db250cm9sbGVyIiwiZGVmYXVsdCIsIltvYmplY3QgT2JqZWN0XSIsImluaXREYXRhIiwic3VwZXIiLCJ0aGlzIiwiaW1hZ2VTZXJ2aWNlIiwic2VydmljZXMiLCJJbWFnZVNlcnZpY2UiLCJkYiIsInNlcXVlbGl6ZSIsIm1vZGVscyIsImltYWdlVVJMRm9ybWF0dGVyIiwiZmlsZW5hbWUiLCJCQVNFX1VSTCIsIklNQUdFX01PVU5UX1BBVEgiLCJhZGRJbnRlcmNlcHRvciIsInJlcSIsInJlcyIsIm5leHQiLCJ2ZXJib3NlIiwicGF0aCIsImxvY2FscyIsInNpdGVIYXNoIiwicm91dGVQb3N0IiwiYm9keSIsImpzb24iLCJzdGF0dXMiLCJkYXRhIiwiZ2V0SW1hZ2VVUkwiLCJyb3V0ZUdldCIsImdldEltYWdlcyIsInRoZW4iLCJyZXNwIiwiSlNPTiIsInN0cmluZ2lmeSIsImNhdGNoIiwiZ2V0RXhwcmVzc1VwbG9hZE1pZGRsZXdhcmUiLCJJTUFHRV9QQVRIIiwiZGVsZXRlSW1hZ2UiLCJyZW5kZXJTaWRlYmFyIiwicmVuZGVyIiwicG9wdWxhdGVWaWV3cyIsInJvdXRlVXNlIiwiZ2V0Um91dGVyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Im9FQUFBLE1BQUFBLGtCQUFBQyxRQUFBLGlDQUNBQyw4QkFBQUQsUUFBQSw2Q0FDQUUsZ0NBQUFGLFFBQUEsK0NBQ0FHLGdDQUFBSCxRQUFBLCtDQUNBSSw2QkFBQUosUUFBQSw0Q0FDQUssaUNBQUFMLFFBQUEsZ0RBQ0FNLG1CQUFBTixRQUFBLGdDQUdBTyxNQUFBUCxRQUFBLGlCQUVBUSxhQUFBUixRQUFBLGlCQUVNUyxJQUFNVCxRQUFRLFVBRWRVLElBQU0sdUJBQ1pDLHVCQUE2Qlosa0JBQUFhLFFBSTNCQyxZQUFhQyxHQUNYQyxNQUFNRCxHQUNORSxLQUFLQyxhQUFlLElBQUlILEVBQVNJLFNBQVNDLGFBQWFMLEVBQVNNLEdBQUdDLFVBQVdQLEVBQVNNLEdBQUdFLFFBQzFGTixLQUFLTyxrQkFBb0JDLENBQUFBLE1BQWVoQixhQUFBSSxRQUFVYSxXQUFXakIsYUFBQUksUUFBVWMsbUJBQW1CRixLQUUxRlIsS0FBS1csZUFBZSxDQUFDQyxFQUFLQyxFQUFLQyxLQUM3QnJCLElBQUlzQixRQUFRckIsSUFBSyxZQUFja0IsRUFBSUksTUFDbkNILEVBQUlJLE9BQU9DLFNBQVdsQixLQUFLa0IsU0FDM0JKLE1BR0ZkLEtBQUttQixVQUFVLGlCQUFrQixDQUFDUCxFQUFLQyxFQUFLQyxLQUMxQyxNQUFNTixFQUFXSSxFQUFJUSxLQUFLWixTQUMxQkssRUFBSVEsTUFBT0MsUUFBUSxFQUFNQyxLQUFNaEMsTUFBTWlDLFlBQVloQixPQUduRFQsTUFBTTBCLFNBQVMsVUFBVyxDQUFDYixFQUFLQyxFQUFLQyxLQUNuQ2QsS0FBS0MsYUFBYXlCLFVBQVUxQixLQUFLTyxtQkFBbUJvQixLQUFLQyxJQUN2RG5DLElBQUlzQixRQUFRckIsSUFBSyxpQkFBbUJtQyxLQUFLQyxVQUFVRixJQUNuRGYsRUFBSVEsS0FBS08sS0FDUkcsTUFBTWpCLEtBR1hmLE1BQU1vQixVQUFVLFNBQ2RuQixLQUFLQyxhQUFhK0IsMkJBQ2hCeEMsYUFBQUksUUFBVXFDLFdBQVlqQyxLQUFLTyxvQkFFL0JSLE1BQU1vQixVQUFVLGdCQUFpQixDQUFDUCxFQUFLQyxFQUFLQyxLQUMxQ3JCLElBQUlzQixRQUFRckIsSUFBSywrQkFBaUNtQyxLQUFLQyxVQUFVbEIsRUFBSVEsT0FDckVwQixLQUFLQyxhQUFhaUMsWUFBWTFDLGFBQUFJLFFBQVVxQyxXQUFZckIsRUFBSVEsS0FBS1osVUFBVW1CLEtBQUtDLElBQzFFZixFQUFJUSxLQUFLTyxLQUNSRyxNQUFNakIsS0FHWGQsS0FBS3lCLFNBQVMsSUFBSyxDQUFDYixFQUFLQyxFQUFLQyxLQUM1QkQsRUFBSUksT0FBT2tCLGVBQWdCLEVBQzNCdEIsRUFBSXVCLE9BQU8sd0JBR2JwQyxLQUFLeUIsU0FBUyxrQkFBbUIsQ0FBQ2IsRUFBS0MsRUFBS0MsS0FDMUN4QixtQkFBQU0sUUFBZXlDLGdCQUFnQlYsS0FBS0MsSUFDbENmLEVBQUlRLEtBQUtPLEtBQ1JHLE1BQU1qQixLQUdYZCxLQUFLc0MsU0FBUyxzQkFBdUIsSUFBSW5ELGdDQUFBUyxRQUE0QkUsR0FBVXlDLGFBQy9FdkMsS0FBS3NDLFNBQVMsbUJBQW9CLElBQUlsRCw2QkFBQVEsUUFBeUJFLEdBQVV5QyxhQUN6RXZDLEtBQUtzQyxTQUFTLHVCQUF3QixJQUFJakQsaUNBQUFPLFFBQTZCRSxHQUFVeUMsYUFDakZ2QyxLQUFLc0MsU0FBUyxvQkFBcUIsSUFBSXJELDhCQUFBVyxRQUEwQkUsR0FBVXlDLGFBQzNFdkMsS0FBS3NDLFNBQVMsc0JBQXVCLElBQUlwRCxnQ0FBQVUsUUFBNEJFLEdBQVV5QyxjQUluRkMsT0FBT0MsUUFBVTlDIiwiZmlsZSI6ImNtcy9tYWluLWNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmFzZUNvbnRyb2xsZXIgZnJvbSAnLi9jb250cm9sbGVycy9iYXNlLWNvbnRyb2xsZXInXG5pbXBvcnQgT3JkZXJNYW5hZ2VtZW50Q29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXJzL29yZGVyLW1hbmFnZW1lbnQtY29udHJvbGxlcidcbmltcG9ydCBBY2NvdW50TWFuYWdlbWVudENvbnRyb2xsZXIgZnJvbSAnLi9jb250cm9sbGVycy9hY2NvdW50LW1hbmFnZW1lbnQtY29udHJvbGxlcidcbmltcG9ydCBQcm9kdWN0TWFuYWdlbWVudENvbnRyb2xsZXIgZnJvbSAnLi9jb250cm9sbGVycy9wcm9kdWN0LW1hbmFnZW1lbnQtY29udHJvbGxlcidcbmltcG9ydCBTaG9wTWFuYWdlbWVudENvbnRyb2xsZXIgZnJvbSAnLi9jb250cm9sbGVycy9zaG9wLW1hbmFnZW1lbnQtY29udHJvbGxlcidcbmltcG9ydCBTdXBwbGllck1hbmFnZW1lbnRDb250cm9sbGVyIGZyb20gJy4vY29udHJvbGxlcnMvc3VwcGxpZXItbWFuYWdlbWVudC1jb250cm9sbGVyJ1xuaW1wb3J0IFNRTFZpZXdTZXJ2aWNlIGZyb20gJy4uL3NlcnZpY2VzL3NxbC12aWV3LXNlcnZpY2UnXG5cbmltcG9ydCB7IFNpdGVEYXRhLCBJbWFnZVNlcnZpY2UgfSBmcm9tICcuLi9zaXRlLWRlZmluaXRpb25zJ1xuaW1wb3J0ICogYXMgVXRpbHMgZnJvbSAnLi4vbGlicy91dGlscydcblxuaW1wb3J0IEFwcENvbmZpZyBmcm9tICcuLi9hcHAtY29uZmlnJ1xuXG5jb25zdCBsb2cgPSByZXF1aXJlKCducG1sb2cnKVxuXG5jb25zdCBUQUcgPSAnTWFpbkNvbnRyb2xsZXInXG5jbGFzcyBNYWluQ29udHJvbGxlciBleHRlbmRzIEJhc2VDb250cm9sbGVyIHtcbiAgcHJpdmF0ZSBpbWFnZVNlcnZpY2U6IEltYWdlU2VydmljZVxuICBwcml2YXRlIHJlYWRvbmx5IGltYWdlVVJMRm9ybWF0dGVyXG5cbiAgY29uc3RydWN0b3IgKGluaXREYXRhOiBTaXRlRGF0YSkge1xuICAgIHN1cGVyKGluaXREYXRhKVxuICAgIHRoaXMuaW1hZ2VTZXJ2aWNlID0gbmV3IGluaXREYXRhLnNlcnZpY2VzLkltYWdlU2VydmljZShpbml0RGF0YS5kYi5zZXF1ZWxpemUsIGluaXREYXRhLmRiLm1vZGVscylcbiAgICB0aGlzLmltYWdlVVJMRm9ybWF0dGVyID0gZmlsZW5hbWUgPT4gYCR7QXBwQ29uZmlnLkJBU0VfVVJMfSR7QXBwQ29uZmlnLklNQUdFX01PVU5UX1BBVEh9JHtmaWxlbmFtZX1gXG5cbiAgICB0aGlzLmFkZEludGVyY2VwdG9yKChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgbG9nLnZlcmJvc2UoVEFHLCAncmVxLnBhdGg9JyArIHJlcS5wYXRoKVxuICAgICAgcmVzLmxvY2Fscy5zaXRlSGFzaCA9IHRoaXMuc2l0ZUhhc2hcbiAgICAgIG5leHQoKVxuICAgIH0pXG5cbiAgICB0aGlzLnJvdXRlUG9zdCgnL2ltYWdlL2dldC11cmwnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVuYW1lID0gcmVxLmJvZHkuZmlsZW5hbWVcbiAgICAgIHJlcy5qc29uKHsgc3RhdHVzOiB0cnVlLCBkYXRhOiBVdGlscy5nZXRJbWFnZVVSTChmaWxlbmFtZSkgfSlcbiAgICB9KVxuXG4gICAgc3VwZXIucm91dGVHZXQoJy9pbWFnZXMnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIHRoaXMuaW1hZ2VTZXJ2aWNlLmdldEltYWdlcyh0aGlzLmltYWdlVVJMRm9ybWF0dGVyKS50aGVuKHJlc3AgPT4ge1xuICAgICAgICBsb2cudmVyYm9zZShUQUcsICcvaW1hZ2VzLkdFVCgpOicgKyBKU09OLnN0cmluZ2lmeShyZXNwKSlcbiAgICAgICAgcmVzLmpzb24ocmVzcClcbiAgICAgIH0pLmNhdGNoKG5leHQpXG4gICAgfSlcblxuICAgIHN1cGVyLnJvdXRlUG9zdCgnL2ltYWdlJyxcbiAgICAgIHRoaXMuaW1hZ2VTZXJ2aWNlLmdldEV4cHJlc3NVcGxvYWRNaWRkbGV3YXJlKFxuICAgICAgICBBcHBDb25maWcuSU1BR0VfUEFUSCwgdGhpcy5pbWFnZVVSTEZvcm1hdHRlcikpXG5cbiAgICBzdXBlci5yb3V0ZVBvc3QoJy9pbWFnZS9kZWxldGUnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGxvZy52ZXJib3NlKFRBRywgJ2ltYWdlL2RlbGV0ZS5QT1NUOiByZXEuYm9keT0nICsgSlNPTi5zdHJpbmdpZnkocmVxLmJvZHkpKVxuICAgICAgdGhpcy5pbWFnZVNlcnZpY2UuZGVsZXRlSW1hZ2UoQXBwQ29uZmlnLklNQUdFX1BBVEgsIHJlcS5ib2R5LmZpbGVuYW1lKS50aGVuKHJlc3AgPT4ge1xuICAgICAgICByZXMuanNvbihyZXNwKVxuICAgICAgfSkuY2F0Y2gobmV4dClcbiAgICB9KVxuXG4gICAgdGhpcy5yb3V0ZUdldCgnLycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgcmVzLmxvY2Fscy5yZW5kZXJTaWRlYmFyID0gdHJ1ZVxuICAgICAgcmVzLnJlbmRlcigncHJvZHVjdC1tYW5hZ2VtZW50JylcbiAgICB9KVxuXG4gICAgdGhpcy5yb3V0ZUdldCgnL3BvcHVsYXRlLXZpZXdzJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBTUUxWaWV3U2VydmljZS5wb3B1bGF0ZVZpZXdzKCkudGhlbihyZXNwID0+IHtcbiAgICAgICAgcmVzLmpzb24ocmVzcClcbiAgICAgIH0pLmNhdGNoKG5leHQpXG4gICAgfSlcblxuICAgIHRoaXMucm91dGVVc2UoJy9wcm9kdWN0LW1hbmFnZW1lbnQnLCBuZXcgUHJvZHVjdE1hbmFnZW1lbnRDb250cm9sbGVyKGluaXREYXRhKS5nZXRSb3V0ZXIoKSlcbiAgICB0aGlzLnJvdXRlVXNlKCcvc2hvcC1tYW5hZ2VtZW50JywgbmV3IFNob3BNYW5hZ2VtZW50Q29udHJvbGxlcihpbml0RGF0YSkuZ2V0Um91dGVyKCkpXG4gICAgdGhpcy5yb3V0ZVVzZSgnL3N1cHBsaWVyLW1hbmFnZW1lbnQnLCBuZXcgU3VwcGxpZXJNYW5hZ2VtZW50Q29udHJvbGxlcihpbml0RGF0YSkuZ2V0Um91dGVyKCkpXG4gICAgdGhpcy5yb3V0ZVVzZSgnL29yZGVyLW1hbmFnZW1lbnQnLCBuZXcgT3JkZXJNYW5hZ2VtZW50Q29udHJvbGxlcihpbml0RGF0YSkuZ2V0Um91dGVyKCkpXG4gICAgdGhpcy5yb3V0ZVVzZSgnL2FjY291bnQtbWFuYWdlbWVudCcsIG5ldyBBY2NvdW50TWFuYWdlbWVudENvbnRyb2xsZXIoaW5pdERhdGEpLmdldFJvdXRlcigpKVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTWFpbkNvbnRyb2xsZXJcbiJdfQ==
